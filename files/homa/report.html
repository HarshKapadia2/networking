<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Harsh Kapadia">
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<title>Homa</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Homa</h1>
<div class="details">
<span id="author" class="author">Harsh Kapadia</span><br>
<span id="email" class="email"><a href="mailto:harshk@bu.edu">harshk@bu.edu</a></span><br>
<span id="revdate">Boston University — Spring 2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_data_center_environment">Data Center Environment</a>
<ul class="sectlevel2">
<li><a href="#_topology">Topology</a></li>
<li><a href="#_protocol_requirements">Protocol Requirements</a></li>
</ul>
</li>
<li><a href="#_message_vs_packet">Message vs Packet</a></li>
<li><a href="#_problems_with_tcp">Problems with TCP</a>
<ul class="sectlevel2">
<li><a href="#_stream_orientation">Stream Orientation</a></li>
<li><a href="#_connection_orientation">Connection Orientation</a></li>
<li><a href="#_fair_scheduling">Fair Scheduling</a></li>
<li><a href="#_sender_driven_congestion_control">Sender-Driven Congestion Control</a></li>
<li><a href="#_in_order_packet_delivery">In-Order Packet Delivery</a></li>
</ul>
</li>
<li><a href="#_sender_vs_receiver">Sender vs Receiver</a></li>
<li><a href="#_features">Features</a>
<ul class="sectlevel2">
<li><a href="#_message_orientation">Message Orientation</a></li>
<li><a href="#_receiver_driven_congestion_control">Receiver-Driven Congestion control</a></li>
<li><a href="#_connectionless_protocol">Connectionless Protocol</a></li>
<li><a href="#_shortest_remaining_processing_time">Shortest Remaining Processing Time</a></li>
<li><a href="#_no_per_packet_acknowledgements">No Per-Packet Acknowledgements</a></li>
<li><a href="#_high_out_of_order_packet_tolerance">High Out-of-Order Packet Tolerance</a></li>
<li><a href="#_at_least_once_semantics">At-Least-Once Semantics</a></li>
</ul>
</li>
<li><a href="#_peers_rpcs_and_receivers">Peers, RPCs and Receivers</a></li>
<li><a href="#_priorities">Priorities</a>
<ul class="sectlevel2">
<li><a href="#_sender">Sender</a></li>
<li><a href="#_receiver">Receiver</a></li>
<li><a href="#_sending_data">Sending Data</a></li>
</ul>
</li>
<li><a href="#_packet_types">Packet Types</a>
<ul class="sectlevel2">
<li><a href="#_data_packet"><code>DATA</code> Packet</a></li>
<li><a href="#_grant_packet"><code>GRANT</code> Packet</a></li>
<li><a href="#_resend_packet"><code>RESEND</code> Packet</a></li>
<li><a href="#_unknown_packet"><code>UNKNOWN</code> Packet</a></li>
<li><a href="#_busy_packet"><code>BUSY</code> Packet</a></li>
<li><a href="#_cutoffs_packet"><code>CUTOFFS</code> Packet</a></li>
<li><a href="#_ack_packet"><code>ACK</code> Packet</a></li>
<li><a href="#_need_ack_packet"><code>NEED_ACK</code> Packet</a></li>
</ul>
</li>
<li><a href="#_rttbytes"><code>RTTbytes</code></a></li>
<li><a href="#_working">Working</a>
<ul class="sectlevel2">
<li><a href="#_client">Client</a></li>
<li><a href="#_server">Server</a></li>
</ul>
</li>
<li><a href="#_message_sequence_scenarios">Message Sequence Scenarios</a>
<ul class="sectlevel2">
<li><a href="#_error_free_communication">Error-Free Communication</a></li>
<li><a href="#_scheduled_data_loss">Scheduled Data Loss</a></li>
<li><a href="#_aborted_rpc">Aborted RPC</a></li>
<li><a href="#_unscheduled_data_loss">Unscheduled Data Loss</a></li>
</ul>
</li>
<li><a href="#_conclusion">Conclusion</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a></li>
<li><a href="#_contact">Contact</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Homa is a new transport protocol designed specifically for Data Centers and operates at the Transport Layer of the <a href="https://en.wikipedia.org/wiki/OSI_model#Layer_architecture" target="_blank" rel="noopener">OSI Model</a>.</p>
</li>
<li>
<p>It aims to replace the <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" target="_blank" rel="noopener">Transmission Control Protocol (TCP)</a> as the transport protocol in Data Centers and claims to fix all of TCP&#8217;s problems.</p>
</li>
<li>
<p>Homa&#8217;s primary goal is to provide the lowest possible latency for short messages at high network load.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_center_environment"><a class="anchor" href="#_data_center_environment"></a>Data Center Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Homa is a transport protocol meant for Data Centers, it is important to understand a typical Data Center structure and the requirements of protocols operating in such an environment.</p>
</div>
<div class="sect2">
<h3 id="_topology"><a class="anchor" href="#_topology"></a>Topology</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/typical-data-center-cluster.png" alt="A typical Data Center cluster">
</div>
<div class="title">Figure 1. A typical Data Center cluster</div>
</div>
<div class="paragraph">
<p>Considering a generalised Data Center topology:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Data Center typically consists of various clusters. Each cluster consists of multiple racks and each rack consists of multiple machines (hosts/peers).</p>
</li>
<li>
<p>Each rack has a switch that connects all the machines in that rack, called the <a href="https://community.fs.com/blog/tor-vs-eor-data-center-architecture-design.html" target="_blank" rel="noopener">Top of Rack (ToR) switch</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_protocol_requirements"><a class="anchor" href="#_protocol_requirements"></a>Protocol Requirements</h3>
<div class="ulist">
<ul>
<li>
<p>Low latency</p>
<div class="ulist">
<ul>
<li>
<p>Tail latency should be good.</p>
</li>
<li>
<p>Packet processing overheads should be low.</p>
</li>
</ul>
</div>
</li>
<li>
<p>High throughput</p>
<div class="ulist">
<ul>
<li>
<p>Both data throughput (amount of data sent) and message throughput (no. of messages sent) should be high.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Reliable delivery</p>
<div class="ulist">
<ul>
<li>
<p>Data should be delivered regardless of failures.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Congestion Control</p>
<div class="ulist">
<ul>
<li>
<p>Congestion (packet buildup in buffers) needs to be kept at a minimum to ensure low latency.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Efficient Load Balancing</p>
<div class="ulist">
<ul>
<li>
<p>Links and processor cores should be be hot spots.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_message_vs_packet"><a class="anchor" href="#_message_vs_packet"></a>Message vs Packet</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/message-vs-packet.png" alt="Message vs Packet">
</div>
<div class="title">Figure 2. A message is transmitted by splitting it into packets.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Message: A logically sensible, complete and dispatchable data unit that makes sense in its entirety and can be processed.</p>
</li>
<li>
<p>Packet: A chunk/part of a message that can be combined with other packets of that message to form the complete message.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problems_with_tcp"><a class="anchor" href="#_problems_with_tcp"></a>Problems with TCP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_stream_orientation"><a class="anchor" href="#_stream_orientation"></a>Stream Orientation</h3>
<div class="ulist">
<ul>
<li>
<p>TCP is a Stream-Oriented Protocol. It blindly creates packets of a certain length as and when the Session Layer (<a href="https://en.wikipedia.org/wiki/OSI_model#Layer_architecture" target="_blank" rel="noopener">OSI Model</a>) above it gives it data, without having any knowledge of a logical chunk of data (a message).</p>
<div class="ulist">
<ul>
<li>
<p>Content (Message) lengths present at higher layers (like the Application Layer <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Length" target="_blank" rel="noopener">HTTP protocol <code>Content-Length</code> header</a>) are not visible to TCP.</p>
</li>
</ul>
</div>
</li>
<li>
<p>So TCP is not aware of the message size. It is only aware of the length of the current packet.</p>
</li>
<li>
<p>This means that the receiver does not have immediate knowledge as to when it can start processing data. It has to figure that out by looking through and parsing the request data sent.</p>
</li>
<li>
<p>The receiver also does not know how much data it is going to receive, so the sender is responsible to not overwhelm the receiver.</p>
</li>
<li>
<p>As TCP is a stream, it prefers to follow one path to its destination (Flow-Consistent Routing), to prevent too much packet reordering. This leads to Load Balancing issues, because multiple TCP flows along the same path can cause congestion and <a href="https://networking.harshkapadia.me/tcp#tcp-head-of-line-blocking" target="_blank" rel="noopener">TCP Head-of-Line Blocking (HoLB)</a>.</p>
</li>
<li>
<p>Another issue with streaming is that there is a chance of multiple application threads on the receiver reading data not meant for them, because the receiver doesn&#8217;t immediately know where a message starts or ends at the Transport Layer. With protocols like <a href="https://en.wikipedia.org/wiki/HTTP/2" target="_blank" rel="noopener">HTTP/2</a> which multiplex multiple requests on the same TCP connection, this problem becomes even more apparent.</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://networking.harshkapadia.me/tcp#tcp-head-of-line-blocking" target="_blank" rel="noopener">HTTP/2 also suffers from TCP HoLB.</a></p>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://en.wikipedia.org/wiki/HTTP/3" target="_blank" rel="noopener">HTTP/3</a> protocol solves this issue by using the <a href="https://en.wikipedia.org/wiki/QUIC" target="_blank" rel="noopener">QUIC</a> transport protocol in place of TCP, but all the other issues with streaming remain.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_connection_orientation"><a class="anchor" href="#_connection_orientation"></a>Connection Orientation</h3>
<div class="ulist">
<ul>
<li>
<p>TCP is a Connection-Oriented Protocol.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Connection_establishment" target="_blank" rel="noopener">TCP does a three-way handshake</a> to establish a connection between a sender and a receiver, which takes ~1 RTT (Round-Trip Time), where data is not being sent.</p>
</li>
<li>
<p>Each application might have hundreds or thousands of connections and a Data Center might have thousands or millions of applications!</p>
</li>
<li>
<p>Thus, connection-orientation causes a lot of overheads in terms of storage, compute, goodput and latency.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fair_scheduling"><a class="anchor" href="#_fair_scheduling"></a>Fair Scheduling</h3>
<div class="ulist">
<ul>
<li>
<p>TCP uses Fair Scheduling to share bandwidth between various connections, where all TCP streams/flows get an equal bandwidth.</p>
</li>
<li>
<p>Under high load, all streams try to share bandwidth equally, which collectively slows down everyone.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sender_driven_congestion_control"><a class="anchor" href="#_sender_driven_congestion_control"></a>Sender-Driven Congestion Control</h3>
<div class="ulist">
<ul>
<li>
<p>In the TCP model, the sender is responsible to implement Flow Control and Congestion Control, to not overwhelm the receiver and network switches respectively.</p>
</li>
<li>
<p>Detection of congestion causes TCP to reduce its sending rate, which reduces throughput and Link Utilization.</p>
</li>
<li>
<p>The sender mostly detects congestion by packet loss, duplicate acknowledgements and timeouts (among other parameters), which means:</p>
<div class="ulist">
<ul>
<li>
<p>Assumption of congestion</p>
<div class="ulist">
<ul>
<li>
<p>TCP assumes congestion on packet loss, whether that is the reality or not.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Inaccurate congestion detection (False positives)</p>
<div class="ulist">
<ul>
<li>
<p>TCP has an issue of falsely detecting congestion at times, because packet loss isn&#8217;t always caused by congestion.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Detection only after congestion</p>
<div class="ulist">
<ul>
<li>
<p>If it detects congestion, it does so only after queuing/buffer buildup has started.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>All of the issues above mean that TCP bases its logic off of assumption and reduces its sending rate based on those inaccurate assumptions, which leads to throughput loss.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_in_order_packet_delivery"><a class="anchor" href="#_in_order_packet_delivery"></a>In-Order Packet Delivery</h3>
<div class="ulist">
<ul>
<li>
<p>TCP has a lower out-of-order packet tolerance than Homa.</p>
</li>
<li>
<p>TCP prefers that packets are sent in-order and so on the same link (Flow-Consistent Routing).</p>
</li>
<li>
<p>As discussed in the <a href="#_stream_orientation">Stream Orientation</a> sub-section above, Flow-Consistent Routing causes hot spots to develop (Load Balancing issues), which leads to congestion and TCP HoLB.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sender_vs_receiver"><a class="anchor" href="#_sender_vs_receiver"></a>Sender vs Receiver</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depending on the direction of communication, a client and a server can be the sender and the receiver respectively, or vice versa.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Direction of communication defining clients and servers as senders or receivers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Client &#8594; Server (Request)</th>
<th class="tableblock halign-left valign-top">Server &#8594; Client (Response/Reply)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receiver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_features"><a class="anchor" href="#_features"></a>Features</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Homa&#8217;s features that fulfill a Data Center protocol&#8217;s requirements</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol Requirement</th>
<th class="tableblock halign-left valign-top">Homa Feature(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low latency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connectionless protocol, Shortest Remaining Processing Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High throughput</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receiver-driven Congestion control, Connectionless protocol, Shortest Remaining Processing Time, No per-packet acknowledgements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reliable delivery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At-Lease-Once semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Congestion Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receiver-driven Congestion Control, Shortest Remaining Processing Time, High out-of-order packet tolerance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Efficient Load Balancing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receiver-driven Congestion control, High out-of-order packet tolerance</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Homa&#8217;s features:</p>
</div>
<div class="sect2">
<h3 id="_message_orientation"><a class="anchor" href="#_message_orientation"></a>Message Orientation</h3>
<div class="ulist">
<ul>
<li>
<p>Homa is a Message-Oriented Protocol unlike TCP, which is a Stream-Oriented Protocol. This means that Homa is aware of the overall message length at the Transport Layer unlike TCP, which is only aware of packet lengths that it has to create.</p>
</li>
<li>
<p>Homa implements <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" target="_blank" rel="noopener">Remote Procedure Calls (RPCs)</a>, which exposes a measurable dispatch unit (<a href="#_message_vs_packet">a 'message'</a>) to the transport layer.</p>
</li>
<li>
<p>Now that the sender knows how much data it has to send to complete the RPC Request (= message length), it communicates that message length to the server in the first packet.</p>
</li>
<li>
<p>This enables the receiver to know how much data it is expecting, how much data has arrived and how much is pending for every RPC.</p>
</li>
<li>
<p>This is game changing, because Homa can now implement <a href="#_receiver_driven_congestion_control">Receiver-Driven Congestion control</a> as described in the next sub-point below.</p>
</li>
<li>
<p>Knowing the full message length also lets the receiver know when it has received the message in its entirety right at the Transport Layer, so that the appropriate application thread can consume the message and carry out the required action(s). There is no fear of reading a packet from a different message, as for example with TCP in HTTP/2.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_receiver_driven_congestion_control"><a class="anchor" href="#_receiver_driven_congestion_control"></a>Receiver-Driven Congestion control</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#_sender_driven_congestion_control">As discussed before</a>, Sender-Driven Congestion Control is inaccurate, is based on assumptions and detects congestion only after it has occurred.</p>
</li>
<li>
<p>Using Homa, the receiver knows the total data each RPC is going to send it, so it can implement mechanisms to implement Flow and Congestion Control.</p>
<div class="ulist">
<ul>
<li>
<p><a href="#_message_orientation">As mentioned before</a>, the sender sends the message length to the server in the first packet.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Letting the receiver control each RPC sender&#8217;s flow is more accurate and not based on assumptions, because the receiver knows how much data is going to receive from all RPCs trying to send data to it.</p>
</li>
<li>
<p>The receiver can make decisions of whether to grant permission to a RPC to send data to it based on its buffer occupancy, available bandwidth, observed RTT, etc. These decisions can be made in real-time as well and new instructions can be communicated to the sender whenever the receiver deems fit.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_connectionless_protocol"><a class="anchor" href="#_connectionless_protocol"></a>Connectionless Protocol</h3>
<div class="ulist">
<ul>
<li>
<p>Homa uses RPCs and so it doesn&#8217;t require explicit connection establishment between the sender and receiver. This reduces connection setup overhead, in terms of storage, compute, goodput and latency.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_shortest_remaining_processing_time"><a class="anchor" href="#_shortest_remaining_processing_time"></a>Shortest Remaining Processing Time</h3>
<div class="ulist">
<ul>
<li>
<p>Homa implements Shortest Remaining Processing Time (SRPT) Scheduling to queue messages to send, rather than <a href="#_fair_scheduling">TCP&#8217;s Fair Scheduling</a>.</p>
</li>
<li>
<p>'Processing time' corresponds to the amount of the message left to be transmitted/received.</p>
</li>
<li>
<p>The lesser the data left to be transmitted/received (i.e., the lesser the processing time), the earlier the message will be sent (i.e., the higher the priority the message will have).</p>
</li>
<li>
<p>Thus, SRPT prevents short messages from starving behind long messages in queues on both ends, which solves the TCP HoLB problem.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_no_per_packet_acknowledgements"><a class="anchor" href="#_no_per_packet_acknowledgements"></a>No Per-Packet Acknowledgements</h3>
<div class="ulist">
<ul>
<li>
<p>Homa does not send out explicit acknowledgements for every packet, thus reducing almost half the packets that have to be sent per message in comparison to TCP.</p>
</li>
<li>
<p>This reduces transmission overheads and conserves bandwidth.</p>
</li>
<li>
<p>Homa does send some Control Packets to regulate the protocol, but they are not nearly as frequently sent as TCP acknowledgements.</p>
<div class="ulist">
<ul>
<li>
<p>More details about Homa&#8217;s <a href="#_packet_types">packets</a> and <a href="#_working">working</a> can be found below.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_high_out_of_order_packet_tolerance"><a class="anchor" href="#_high_out_of_order_packet_tolerance"></a>High Out-of-Order Packet Tolerance</h3>
<div class="ulist">
<ul>
<li>
<p>Packet Spraying</p>
<div class="ulist">
<ul>
<li>
<p>Packet Spraying is a technique in which packets of one flow are sent over multiple short paths to the destination, rather than just using one path for the entire flow (<a href="#_in_order_packet_delivery">as in TCP&#8217;s Flow-Consistent Routing</a>).</p>
</li>
<li>
<p>Packet Spraying is advantageous because it aids in Load Balancing packets over multiple links, avoiding network traffic hot spot creation on particular paths/links. This keeps congestion to the minimum.</p>
</li>
<li>
<p>The problem with different packets being sent on different links is that the packets will reach the destination at different times and out of order, so there will be an increased reordering of packets.</p>
<div class="ulist">
<ul>
<li>
<p>Excessive reordering of packets causes unnecessary timeouts, which causes unnecessary retransmissions and that wastes bandwidth.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Homa can reap Packet Spraying&#8217;s Load Balancing benefits without worrying too much about the added reordering causing retransmissions, because it has a higher out-of-order packet tolerance than TCP. In extreme cases where a RPC has to be aborted, Homa will restart the communication as well.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_at_least_once_semantics"><a class="anchor" href="#_at_least_once_semantics"></a>At-Least-Once Semantics</h3>
<div class="ulist">
<ul>
<li>
<p>Homa is a reliable protocol and implements <a href="https://www.lightbend.com/blog/how-akka-works-at-least-once-message-delivery#:~:text=Message%20Delivery%20Semantics" target="_blank" rel="noopener">At-Least-Once semantics</a> to provide reliability.</p>
</li>
<li>
<p>In case of failures or losses, Homa does have mechanisms to ensure retransmission, so packets are sent at least once, but can be sent more times in case of issues, to ensure delivery.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_peers_rpcs_and_receivers"><a class="anchor" href="#_peers_rpcs_and_receivers"></a>Peers, RPCs and Receivers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A peer (host/machine) can be a sender or a receiver and can have multiple RPCs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. The relation between peers, RPCs and Receivers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sender ID</th>
<th class="tableblock halign-left valign-top">RPC ID</th>
<th class="tableblock halign-left valign-top">Receiver ID</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPC1, RPC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPC3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RPC4, RPC5, RPC6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_priorities"><a class="anchor" href="#_priorities"></a>Priorities</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/homa-unsched-cutoffs.png" alt="Homa&#8217;s priority array">
</div>
<div class="title">Figure 3. Initial values for Homa&#8217;s default priority array (Priority increases from Level 0 to Level 7.)</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Homa makes use of priorities to implement <a href="#_shortest_remaining_processing_time">SRPT Scheduling</a>, which prevents shorter messages from starving behind longer messages (HoLB).</p>
</li>
<li>
<p>The lesser the bytes of a message still to arrive at the receiver, the higher is that message&#8217;s priority.</p>
<div class="ulist">
<ul>
<li>
<p>In case of a tie on the number of bytes left to be transmitted, the older message gets the higher priority.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Homa ranks (gives a priority order to) all RPCs in every peer based on the above criteria and then ranks all the peers based on each one&#8217;s highest priority RPC.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_sender"><a class="anchor" href="#_sender"></a>Sender</h3>
<div class="ulist">
<ul>
<li>
<p>A Homa sender divides all messages into two parts</p>
<div class="ulist">
<ul>
<li>
<p>A small unscheduled part.</p>
<div class="ulist">
<ul>
<li>
<p>It is sent blindly (without waiting for anything) to the receiver to inform it of the total message length.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A larger scheduled part.</p>
<div class="ulist">
<ul>
<li>
<p>It is sent part-by-part as and when the receiver permits (grants) it.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Unscheduled data has higher priority than scheduled data.</p>
</li>
<li>
<p>Homa has eight priority levels by default, from Level 0 (lowest priority) to Level 7 (highest priority).</p>
</li>
<li>
<p>The eight levels are split into two parts by a user-defined parameter (<code>max_sched_prio</code>). The part with the higher priorities is used for unscheduled data, while the other part with lower priorities is used for scheduled data.</p>
<div class="ulist">
<ul>
<li>
<p>Unscheduled data has higher priority because those packets have to reach the receiver as soon as possible to inform it of the total message length.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All packets other than the packets that carry message data bytes are called Control Packets and are always sent at the highest priority, as they help regulate the protocol.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_receiver"><a class="anchor" href="#_receiver"></a>Receiver</h3>
<div class="ulist">
<ul>
<li>
<p>A Homa receiver dynamically decides the priority of a message, because</p>
<div class="ulist">
<ul>
<li>
<p>It knows the amount of data yet to arrive for all the RPCs that it has.</p>
</li>
<li>
<p>It is aware of the load, bandwidth, free buffer space, etc. it has available.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A receiver will inform its senders of the unscheduled and scheduled data priorities it should use.</p>
</li>
<li>
<p>A receiver usually computes new priorities for messages when it needs to send new permission granting packets to RPCs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sending_data"><a class="anchor" href="#_sending_data"></a>Sending Data</h3>
<div class="ulist">
<ul>
<li>
<p>To send unscheduled data, a Homa sender checks if it has received any unscheduled data priorities from the receiver.</p>
<div class="ulist">
<ul>
<li>
<p>If it has, it uses those priorities to send unscheduled data packets.</p>
</li>
<li>
<p>If not, then it uses its own initialized values, which will trigger the receiver to send it its updated values for later unscheduled data.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Once unscheduled data is sent, the receiver usually grants permission to the sender to send (scheduled) data to it and includes the priority level to be used for those scheduled data packets in the permission granting packet itself.</p>
</li>
<li>
<p>To send scheduled data, the sender adds the priority level that it received from the receiver to the new packets with the scheduled data and then sends them across.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packet_types"><a class="anchor" href="#_packet_types"></a>Packet Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Homa&#8217;s packet types:</p>
</div>
<div class="sect2">
<h3 id="_data_packet"><a class="anchor" href="#_data_packet"></a><code>DATA</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">DATA(rpc_id, data_bytes, data_offset, self_priority, message_length)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the sender.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_grant_packet"><a class="anchor" href="#_grant_packet"></a><code>GRANT</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">GRANT(rpc_id, expected_data_offset, expected_scheduled_data_priority)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the receiver.</p>
</li>
<li>
<p>Indicates that the sender may now transmit all bytes in the message up to a given offset.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_resend_packet"><a class="anchor" href="#_resend_packet"></a><code>RESEND</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">RESEND(rpc_id, data_offset, expected_data_length, expected_data_priority)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the sender or receiver.</p>
</li>
<li>
<p>Indicates that the sender should retransmit a given range of bytes within a message.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unknown_packet"><a class="anchor" href="#_unknown_packet"></a><code>UNKNOWN</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">UNKNOWN(rpc_id)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the sender or receiver.</p>
</li>
<li>
<p>Indicates that the RPC for which a packet was received is unknown to it.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_busy_packet"><a class="anchor" href="#_busy_packet"></a><code>BUSY</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">BUSY(rpc_id)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the sender.</p>
</li>
<li>
<p>Indicates that a response to <code>RESEND</code> will be delayed and is used to prevent timeouts.</p>
<div class="ulist">
<ul>
<li>
<p>The sender might be busy transmitting higher priority messages or another RPC operation is still being executed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_cutoffs_packet"><a class="anchor" href="#_cutoffs_packet"></a><code>CUTOFFS</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">CUTOFFS(rpc_id, expected_unscheduled_data_priority)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the receiver.</p>
</li>
<li>
<p>Indicates priority values that the sender should use for unscheduled packets.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ack_packet"><a class="anchor" href="#_ack_packet"></a><code>ACK</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">ACK(rpc_id)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the sender.</p>
</li>
<li>
<p>Explicitly acknowledges the receipt of a response message for one or more RPCs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_need_ack_packet"><a class="anchor" href="#_need_ack_packet"></a><code>NEED_ACK</code> Packet</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">NEED_ACK(rpc_id)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Sent by the receiver.</p>
</li>
<li>
<p>Indicates an explicit requirement for an <code>ACK</code> packet for a particular RPC.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rttbytes"><a class="anchor" href="#_rttbytes"></a><code>RTTbytes</code></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>While sending unscheduled data and in <code>GRANT</code> packets, Homa has to send a certain amount of data and a data offset respectively.</p>
</li>
<li>
<p>The amount of data or data offset is approximately set to <code>RTTbytes</code>, where RTT stands for 'Round-Trip Time'.</p>
</li>
<li>
<p>The value <code>RTTbytes</code> is the number of bytes that can be kept transmitting from the point of sending one packet until the point another packet is received and processed.</p>
</li>
<li>
<p>By the time <code>RTTbytes</code> are transmitted, a <code>GRANT</code> packet will most probably have arrived from the receiver and will have been processed, so the sender can keep transmitting more data without interrupting its sending, thus keeping Link Utilization at 100%.</p>
<div class="ulist">
<ul>
<li>
<p>Sending and receiving can be done at the same time, because links are usually Full Duplex.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working"><a class="anchor" href="#_working"></a>Working</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/homa-message-sequence-diagram-1.png" alt="Homa message sequence diagram">
</div>
<div class="title">Figure 4. A general Homa communication sequence diagram (Priority increases from Level P0 to Level P7.)</div>
</div>
<div class="sect2">
<h3 id="_client"><a class="anchor" href="#_client"></a>Client</h3>
<div class="sect3">
<h4 id="_sender_2"><a class="anchor" href="#_sender_2"></a>Sender</h4>
<div class="ulist">
<ul>
<li>
<p>Whenever Homa (operating at the Transport Layer) receives a message (RPC Request) from the layer above it (Session Layer) at the client, it divides the message (data) into a small 'unscheduled data' part and a larger 'scheduled data' part.</p>
</li>
<li>
<p>The client is starting the communication with the server, so it behaves as the sender.</p>
</li>
<li>
<p>The unscheduled bytes of the message are sent blindly to the receiver (server) in <code>DATA</code> packets as a RPC Request. (<code>DATA</code> packets contain the message length.)</p>
</li>
<li>
<p>If the receiver thinks that it can receive packets from that RPC, it will send a <code>GRANT</code> packet to the sender, which will contain the amount of data that the sender can send (<a href="#_rttbytes"><code>RTTbytes</code></a>) and the <a href="#_priorities">priority at which the packets should be sent</a>.</p>
</li>
<li>
<p>The sender now sends all the data it was granted permission to send, in one or more packets, depending on the MTU (Maximum Transmission Unit).</p>
</li>
<li>
<p><code>GRANT</code> packets keep coming in until the sender has finished sending all its data or till the receiver is able to accept data, whichever comes first.</p>
<div class="ulist">
<ul>
<li>
<p>If the receiver cannot accept more data, it will just not send a <code>GRANT</code> packet for a certain time period. Further information in the <a href="#_message_sequence_scenarios">Message Sequence Scenarios</a> section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_receiver_2"><a class="anchor" href="#_receiver_2"></a>Receiver</h4>
<div class="ulist">
<ul>
<li>
<p>Once the RPC Request has been full transmitted, the sender starts <a href="#_receiver_3">acting as a receiver</a> and waits for a response (RPC Response/Reply) to its request.</p>
</li>
<li>
<p>Once the complete RPC Response has been received, an <code>ACK</code> packet is sent to signal the receipt of the message and the end of that RPC&#8217;s communication.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_server"><a class="anchor" href="#_server"></a>Server</h3>
<div class="sect3">
<h4 id="_receiver_3"><a class="anchor" href="#_receiver_3"></a>Receiver</h4>
<div class="ulist">
<ul>
<li>
<p>On receiving unscheduled <code>DATA</code> packets through a RPC, the receiver (here, the server) checks if it has the capacity to accept connections.</p>
</li>
<li>
<p>If the receiver can accept data, then it calculates</p>
<div class="ulist">
<ul>
<li>
<p>The <a href="#_priorities">priority at which data has to be sent</a> to it.</p>
</li>
<li>
<p>The amount of data that the receiver can accept (<a href="#_rttbytes"><code>RTTbytes</code></a>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>On computing that, the receiver adds that data to a <code>GRANT</code> packet and sends it to the sender asking for more data.</p>
</li>
<li>
<p>The receiver gets <code>DATA</code> packets from the sender for all the data it granted.</p>
</li>
<li>
<p>Once the receiver receives all the packets with the data it had asked for from the sender, it sends another <code>GRANT</code> packet with a newly computed priority and data offset.</p>
</li>
<li>
<p>The receiver keeps receiving <code>DATA</code> packets and keeps sending <code>GRANT</code> packets until the entire message has arrived or until it can accept more data, whichever comes first.</p>
</li>
<li>
<p>Once the entire message (RPC Request) has arrived, the receiver hands it off to the appropriate application thread for processing.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sender_3"><a class="anchor" href="#_sender_3"></a>Sender</h4>
<div class="ulist">
<ul>
<li>
<p>Once the application gets back with a response message, the receiver (the server) starts <a href="#_sender_2">acting as a sender</a>.</p>
</li>
<li>
<p>Once the RPC Response has been transmitted, an <code>ACK</code> packet is expected, to indicate message receipt and as a trigger to get rid of all the state related to that RPC.</p>
<div class="ulist">
<ul>
<li>
<p>If an <code>ACK</code> packet is not received in time, a <code>NEED_ACK</code> packet can be sent, requesting for an <code>ACK</code> packet.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_message_sequence_scenarios"><a class="anchor" href="#_message_sequence_scenarios"></a>Message Sequence Scenarios</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_error_free_communication"><a class="anchor" href="#_error_free_communication"></a>Error-Free Communication</h3>
<div class="paragraph">
<p>Explained in the <a href="#_working">Working</a> section above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scheduled_data_loss"><a class="anchor" href="#_scheduled_data_loss"></a>Scheduled Data Loss</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/homa-message-sequence-diagram-3.png" alt="Homa message sequence diagram">
</div>
<div class="title">Figure 5. A RPC Request where lost scheduled <code>DATA</code> packets trigger <code>RESEND</code> packets.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A RPC Request is shown in the image above.</p>
</li>
<li>
<p>Here, a scheduled <code>DATA</code> packet is lost and the <code>RESEND</code> packet for that missing data is lost as well, but the next <code>RESEND</code> packet that is sent after a timeout makes it to the sender.</p>
</li>
<li>
<p>The sender can either immediately respond with the missing data in a <code>DATA</code> packet or if it is busy transmitting other higher priority packets, then it can send a <code>BUSY</code> packet to the receiver to prevent a timeout (like a 'keep-alive' indicator) and can send the <code>DATA</code> packet once it is free.</p>
<div class="ulist">
<ul>
<li>
<p>Avoiding timeouts helps prevent unnecessary <code>RESEND</code> packets and abortion of the RPC.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_aborted_rpc"><a class="anchor" href="#_aborted_rpc"></a>Aborted RPC</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/homa-message-sequence-diagram-2.png" alt="Homa message sequence diagram">
</div>
<div class="title">Figure 6. A RPC Request where the sender crashes, which causes multiple timeouts and the receiver eventually aborts the RPC. Once online, the sender is forced to restart the communication.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A RPC Request is shown in the image above.</p>
</li>
<li>
<p>The sender crashes after sending two of its three scheduled <code>DATA</code> packets.</p>
</li>
<li>
<p>The first scheduled <code>DATA</code> packet is lost as well, which causes a timeout on the receiver, causing it to send a <code>RESEND</code> packet for the missing data.</p>
</li>
<li>
<p>As the sender has crashed, the <code>RESEND</code> packet does not get an expected <code>DATA</code> packet response, which leads to timeouts and more <code>RESEND</code> packets.</p>
</li>
<li>
<p>After multiple <code>RESEND</code> packets not receiving responses, the receiver determines that the sender is non-responsive and discards all of the state related to that RPC ID.</p>
</li>
<li>
<p>On coming back online, the sender looks at its previous state and tries to resume by sending the third scheduled <code>DATA</code> packet that it had not sent, but the receiver sends an <code>UNKNOWN</code> packet on receipt of that <code>DATA</code> packet, as it had already discarded all information related to that RPC ID.</p>
</li>
<li>
<p>The sender has to restart the communication with the receiver.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unscheduled_data_loss"><a class="anchor" href="#_unscheduled_data_loss"></a>Unscheduled Data Loss</h3>
<div class="imageblock text-center">
<div class="content">
<img src="../img/homa/homa-message-sequence-diagram-4.png" alt="Homa message sequence diagram">
</div>
<div class="title">Figure 7. A RPC Request where the initial unscheduled data itself gets lost, which eventually leads to the client having to restart the communication.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A RPC Request is shown in the image above.</p>
</li>
<li>
<p>If the blindly sent unscheduled <code>DATA</code> packets don&#8217;t reach the receiver due to loss, overload, congestion or other reasons, then the sender times out waiting for a response from the receiver.</p>
</li>
<li>
<p>On timing out, the sender sends a <code>RESEND</code> packet to the receiver, asking for a response.</p>
</li>
<li>
<p>When the <code>RESEND</code> packet reaches the receiver, it will respond with an <code>UNKNOWN</code> packet, because it never got the initial packets and was never aware of the RPC.</p>
</li>
<li>
<p>The sender has to restart the communication with the receiver.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>In conclusion, Homa is wonderful a study in understanding the shortcomings of TCP, designing a protocol to fix those shortcomings to lead to better performance.</p>
</li>
<li>
<p>TCP is one of the most widely used transport protocols in Data Centers and displacing it with Homa is a long way away, but in experiments, Homa has been able to achieve a significantly better performance than TCP, which can be an impetus to adopt it in Data Centers.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I would like to thank <a href="https://sites.bu.edu/matta" target="_blank" rel="noopener">Prof. Dr. Abraham Matta</a> for his guidance, understanding and help throughout the study.</p>
</div>
<div class="paragraph">
<p>I would also like to thank <a href="https://web.stanford.edu/~ouster" target="_blank" rel="noopener">Prof. Dr. John Ousterhout</a> for writing the Homa research papers and Linux Kernel module, and for his help setting up Homa and answering my queries regarding the protocol.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact"><a class="anchor" href="#_contact"></a>Contact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feel free to reach out to the author of this document, <a href="https://harshkapadia.me" target="_blank" rel="noopener">Harsh Kapadia</a>, at <a href="mailto:harshk@bu.edu" target="_blank" rel="noopener">harshk@bu.edu</a> or through <a href="https://links.harshkapadia.me" target="_blank" rel="noopener">links.harshkapadia.me</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Detailed explanations: <a href="https://networking.harshkapadia.me/homa" target="_blank" rel="noopener">networking.harshkapadia.me/homa</a></p>
</li>
<li>
<p>Research papers</p>
<div class="ulist">
<ul>
<li>
<p>J. Ousterhout. <a href="https://arxiv.org/abs/2210.00714v2" target="_blank" rel="noopener"><em>It&#8217;s Time to Replace TCP in the Datacenter.</em></a></p>
</li>
<li>
<p>B. Montazeri, Y. Li, M. Alizadeh, and J. Ousterhout. <a href="https://arxiv.org/abs/1803.09615" target="_blank" rel="noopener"><em>Homa: A Receiver-Driven Low-Latency Transport Protocol Using Network Priorities.</em></a> In Proceedings of the 2018 Conference of the ACM Special Interest Group on Data Communication, SIGCOMM '18, pages 221 - 235, New York, NY, USA, 2018. Association for Computing Machinery.</p>
</li>
<li>
<p>J. Ousterhout. <a href="https://www.usenix.org/conference/atc21/presentation/ousterhout" target="_blank" rel="noopener"><em>A Linux Kernel Implementation of the Homa Transport Protocol.</em></a> In 2021 USENIX Annual Technical Conference (USENIX ATC 21), pages 99 - 115. USENIX Association, July 2021.</p>
</li>
<li>
<p>M. Noormohammadpour and C. S. Raghavendra. <a href="https://ieeexplore.ieee.org/abstract/document/8207422" target="_blank" rel="noopener"><em>Datacenter Traffic Control: Understanding Techniques and Tradeoffs.</em></a> In IEEE Communications Surveys &amp; Tutorials, vol. 20, no. 2, pp. 1492-1525, Secondquarter 2018, doi: 10.1109/COMST.2017.2782753.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/PlatformLab/HomaModule" target="_blank" rel="noopener">Homa Linux Kernel module</a></p>
</li>
<li>
<p><a href="https://github.com/HarshKapadia2/homa-perf" target="_blank" rel="noopener">Homa experimentation</a></p>
</li>
<li>
<p>Detailed references: <a href="https://networking.harshkapadia.me/homa#resources" target="_blank" rel="noopener">networking.harshkapadia.me/homa#resources</a></p>
</li>
</ul>
</div>
<style>
  .imageblock > .title {
	text-align: inherit;
  }
</style>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-05-10 16:32:27 UTC
</div>
</div>
</body>
</html>